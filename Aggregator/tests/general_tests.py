import unittest

from knowledge_extraction.EntityExtractor import EntityExtractor
from parsers.BaseParser2 import BaseParser2
from parsers.DataObject import DataObject
from parsers.MasterParser import MasterParser


class TestBasicFunctions(unittest.TestCase):


    def test_extraction(self):
        master_parser = MasterParser()
        json_test = '''
        {"crawler_name": "veridica", "statement": "Meat, dairy and personal cars, forbidden in Romania", "date": "27.09.2023", "spread_location": "Romania", "fake_news_source": "https://radiogoldfm.ro/16-orase-din-romania-au-aderat-la-structura-c40-ce-si-propune-implementarea-agendei-wef-2030/", "debunking_link": "https://www.veridica.ro/stiri-false/fake-news-carnea-lactatele-si-masinile-personale-interzise-in-romania", "crawler_origin": "https://www.veridica.ro/baza-de-date", "crawled_date": "29/09/2023 17:30:55", "narrative": ["The consumption of meat and dairy and the use of personal cars will be prohibited in Romania"], "verdict": false, "speaker": "", "speaker_job_title": "", "media_channel": "", "likes": -1, "comments": -1, "shares": -1, "journalist_name": "Cezar Manu", "debunk_sources": [], "topic": "", "tags": ["Teoria conspiratiei", "Oculta mondiala"], "fake_news_content": " [...] More cities in Romania plan to eliminate meat, dairy and cars.100 cities formed a coalition, called C40, which established as a target for 2030 0 consumption of meat, 0 dairy consumption, 3 new clothing by person per year, 0 private vehicles, a short-distance flight fromthe person every 3 years.On the list of cities that follow the fulfillment of the world of the World Economic Forum are: Aiud, Alba Iulia, Barlad, Botosani, Brasov, Buzau, Campina, Cluj Napoca, Constanta, Iasi, Lugoj, Moinesti, Petrosani, Pitesti, Suceava, Tulcea, Zalau.There is, at the same time, the objective that by 2030, the communities will gather in the big cities, in order to release as many lands in order to  save the planet . The inhabitants of such megalopolis will be forced to feed with an artificial meat, enriched with proteins from cockroaches. The mayors of the Romanian cities previously prepare the land to meet the absurd and aberrant objectives of the Wef, encouraging the supermarkets that sell artificial meat and reducing the prices to artificial food in general, encouraging the practice of scanning products from the store on the accountown to be able to keep the consumption of meat and dairy under control. By 2035, these measures will become mandatory, because by 2050 it is stipulated that over 90% of the planet's population will stay in urban agglomerations, in smart city and15 -minute cities under permanent supervision.  ", "summary_explanation": "The World Economic Forum (Wef) is a non -governmental international organization for multinational companies, which claims that the world can be most efficient in globalists, a coalition of multinational corporations, governments and organizations of civil society.The foundation also acts as a think tank, publishing a wide range of reports, in different fields of activity such as finances, health, or environmental protection.But regardless of the ideas and wishes of the Wef members, their recommendations have a strictly advisory character and, despite the warnings of conspiracy, are not mandatory.The great reset proposed by the Wef president is only an economic recovery plan, launched in June 2020, in response to the Covid19 pandemic, aimed at reconstruction after the global sanitary crisis, in a way that gives priority to sustainable development.Meanwhile, he has been adapted to include measures to recover the activities strongly affected by the Ukraine war.Above all, Wef has no connection with the study referred to by the analyzed article. C40 is an organization of cities around the world, which focuses on combating the climatic crisis and urban actions that can reduce greenhouse gas emissions, while increasing the health, well -being and economic opportunities of urban residents.The organization conducted a study on the  future of urban consumption in a 1.5degc world  in 2019, that is, prior to launching the initiative of the Great Reset, and its authors and financiers are highlighted on the last page: C40, ARUP andUniversity of Leeds, with Financing from Arup, University of Leeds and Citi Foundation. The study highlights urban economic sectors that contribute significantly to carbon dioxide emissions, and calculates the necessary changes in each sector that could reduce the impact of urban consumption, in accordance with limiting global heating to 1.5 degrees Celsius.The report refers to six categories of activities in which cities could reduce consumption to alleviate climatic changes, and authors model two examples of interventions, in which people completely limit or eliminate the consumption of animal foods, reduce the number of new clothing itemsbought in a year or give up travel with their own car in favor of public transport.In essence, the study is rather an analysis of emissions based on consumption in member cities C40, not a plan that they are obliged to adopt. It is not clear either,  encouraging the practice of scanning products from the store on their own , the authorities will  keep the consumption of meat and dairy under control  and how they will be able to oblige  over 90% of the population of his planetstar in urban agglomerations, [...] under permanent supervision  . Veridica has previously disassembled the false news according to which people will be forced to consume cockroaches, and the hypothesis will reduce prices for artificial food is absurd from two points of view:The prices of food are not regulated by the mayors, and at this moment a kilogram of artificial meat costs several tens of thousands of euros, with very weak prospects that this price will fall significantly in the next 7 years.", "debunking_argument": "The consumption of meat and dairy and the right to have the car will be banned in Romania, according to the erroneous interpretation of an analysis on carbon emissions. The great world reset starts from Barlad, Campina and Moinesti Knowing:  [...] More cities in Romania plan to eliminate meat, dairy and cars.100 cities formed a coalition, called C40, which established as a target for 2030 0 consumption of meat, 0 dairy consumption, 3 new clothing by person per year, 0 private vehicles, a short-distance flight fromthe person every 3 years.On the list of cities that follow the fulfillment of the world of the World Economic Forum are: Aiud, Alba Iulia, Barlad, Botosani, Brasov, Buzau, Campina, Cluj Napoca, Constanta, Iasi, Lugoj, Moinesti, Petrosani, Pitesti, Suceava, Tulcea, Zalau.There is, at the same time, the objective that by 2030, the communities will gather in the big cities, in order to release as many lands in order to  save the planet . The inhabitants of such megalopolis will be forced to feed with an artificial meat, enriched with proteins from cockroaches. The mayors of the Romanian cities previously prepare the land to meet the absurd and aberrant objectives of the Wef, encouraging the supermarkets that sell artificial meat and reducing the prices to artificial food in general, encouraging the practice of scanning products from the store on the accountown to be able to keep the consumption of meat and dairy under control. By 2035, these measures will become mandatory, because by 2050 it is stipulated that over 90% of the planet's population will stay in urban agglomerations, in smart city and15 -minute cities under permanent supervision.   Narration: The population will no longer be allowed to consume animal food and the right to have personal cars. Context: Urban areas are responsible for almost 75% of carbon dioxide emissions worldwide, and specialists say that to avoid catastrophic climate change, a change in how urban areas are designed, built and managed, it is mandatory..That is why, at the international level, a number of organizations of the urban communities were set up which, through a common approach and actions coordinated at global, regional, national and local level, follow the identification of solutions to combat climatic changes. Currently, many cities measure the amount of emissions generated according to the production activity within the territorial limits, but this method does not fully reflect the impact that the cities have on global emissions.85% of the emissions that are associated with the goods and services consumed in the big cities are actually brought from outside the city.The process of manufacturing and transport inside the cities of different products generates huge amounts of greenhouse gases, so one of the solutions considered to reduce carbon dioxide emissions was to reduce consumption, regardless of materials of materialsConstruction, food, clothing and other textiles, transport, electronics and appliances or energy.As a result, more and more programs aim at environmental protection promotes an agenda for reducing the consumption, at the locality level. The narrative of the evil purposes of the world hidden worldwide behind the fight against climate change is not new.Veridica has dismantled over time several such fake news, such as those in which Ecudicatura is stated will push humanity to a feudal social system, or that people will pay to breathe.There are voices that argue even that global warming does not exist.In principle, the basis of these narratives is afraid that the fight against climate change will be poor the population, which will not allow the costs of producing  green  energy. There is also a fear that a strong campaign to combat the effects of global heating led by governments.It could disregard the economic freedoms of the people, and the state would become too strong in relation to civil society. In recent years, the theme is also used by Russian propaganda, in order to divert the attention of public opinion from the invasion and the expansionist policies of the Kremlin.. Objective: undermining the confidence of the population in the authorities and the entire political class, promoting the sovereign and antiocidental discourse, the challenge and amplification of social tensions, as well as the diminution or stopping of the actions that affect the economic interests and business from polluting activities. Recommendation to reduce consumption does not mean prohibition Why is the narration false: the World Economic Forum (Wef) is a non -governmental international organization for multinational companies, which claims that the world can be most efficient in globalists, a multinational corporate coalition, GUverns and organizations of civil society.The foundation also acts as a think tank, publishing a wide range of reports, in different fields of activity such as finances, health, or environmental protection.But regardless of the ideas and wishes of the Wef members, their recommendations have a strictly advisory character and, despite the warnings of conspiracy, are not mandatory.The great reset proposed by the Wef president is only an economic recovery plan, launched in June 2020, in response to the Covid19 pandemic, aimed at reconstruction after the global sanitary crisis, in a way that gives priority to sustainable development.Meanwhile, he has been adapted to include measures to recover the activities strongly affected by the Ukraine war.Above all, Wef has no connection with the study referred to by the analyzed article. C40 is an organization of cities around the world, which focuses on combating the climatic crisis and urban actions that can reduce greenhouse gas emissions, while increasing the health, well -being and economic opportunities of urban residents.The organization conducted a study on the  future of urban consumption in a 1.5degc world  in 2019, that is, prior to launching the initiative of the Great Reset, and its authors and financiers are highlighted on the last page: C40, ARUP andUniversity of Leeds, with Financing from Arup, University of Leeds and Citi Foundation. The study highlights urban economic sectors that contribute significantly to carbon dioxide emissions, and calculates the necessary changes in each sector that could reduce the impact of urban consumption, in accordance with limiting global heating to 1.5 degrees Celsius.The report refers to six categories of activities in which cities could reduce consumption to alleviate climatic changes, and authors model two examples of interventions, in which people completely limit or eliminate the consumption of animal foods, reduce the number of new clothing itemsbought in a year or give up travel with their own car in favor of public transport.In essence, the study is rather an analysis of emissions based on consumption in member cities C40, not a plan that they are obliged to adopt. It is not clear either,  encouraging the practice of scanning products from the store on their own , the authorities will  keep the consumption of meat and dairy under control  and how they will be able to oblige  over 90% of the population of his planetstar in urban agglomerations, [...] under permanent supervision  . Veridica has previously disassembled the false news according to which people will be forced to consume cockroaches, and the hypothesis will reduce prices for artificial food is absurd from two points of view:The prices of food are not regulated by the mayors, and at this moment a kilogram of artificial meat costs several tens of thousands of euros, with very weak prospects that this price will fall significantly in the next 7 years."}
        '''

        parsed = master_parser.parse(json_test)
        self.assertEqual("Cezar Manu", parsed["journalist_name"])
        self.assertEqual({'GPE': ['Romania']}, parsed["title_entities"])
        print(parsed)

    def test_extraction2(self):
        entityExtractor = EntityExtractor()
        source = ['Romania', 'Ukraine', 'war']
        data_object = DataObject()
        data_object.tags = source
        result = entityExtractor.get_tags_entities(data_object)
        self.assertEqual({'keywords': ['war'], 'GPE': ['Romania', 'Ukraine']}, result)


    def test_extraction3(self):
        json_test = '''
        {"crawler_name": "veridica", "statement": "The EU and Romania prepare in Transnistria a scenario as in Nagorno Karabah", "date": "06.10.2023", "spread_location": "Moldavia", "fake_news_source": "https://www.ng.ru/dipkurer/2023-10-01/11_8840_lessons.html?fbclid=IwAR0yDoC_215Q0QsE2bv7wyL4bc4qag-OQTr594vURVKARvoW7qfl5WM5Xrs", "debunking_link": "https://www.veridica.ro/stiri-false/fake-news-ue-si-romania-pregatesc-in-transnistria-un-scenariu-ca-in-nagorno-karabah", "crawler_origin": "https://www.veridica.ro/baza-de-date", "crawled_date": "09/10/2023 13:49:44", "narrative": ["The EU and Romania want to impose the forced annexation of Transnistria by Moldova."], "verdict": false, "speaker": "", "speaker_job_title": "", "media_channel": "", "likes": -1, "comments": -1, "shares": -1, "journalist_name": "Veridica ", "debunk_sources": [], "topic": "", "tags": ["Republic of Moldova", "Russia", "Transnistria", "EU", "The Romanian gendarmerie", "Union of the Republic of Moldova with Romania", "Romania", "The war in Transnistria"], "fake_news_content": "", "summary_explanation": "Both the EU and the US have always pleaded for the peaceful regulation of the conflict.Brussels was the one who first admitted, officially, this year the possibility of accessing the Republic of Moldova to the EU without the Transnistrian region, according to the model of Cyprus.This scenario was presented as a variant that can be taken into account by the High Representative of the European Union for Foreign Affairs and Security Policy, Josep Borrell, in the margin of the European Political Community, which took place in the Republic of Moldova on June 1..This is a proof of the fact that the EU does not insist that the Transnistrian region be brought under the control of Chisinau;The result is that Russia loses a key lever and can no longer block the European course of the Republic of Moldova, endlessly prolonging the frozen conflict in Transnistria.It should be noted, on the other hand, and that the EU does not try to attract the Republic of Moldova, but it wants to become a member of the EU. The assertion that Chisinau authorities would threaten the inhabitants of Transnistria is unfounded.The right-wing politician quoted in the article is not part of a political formation in government or with serious chances of reaching power. Chisinaul also rejected any attack scenario on the Transnistrian region and continues to identify a peaceful conflict regulation solution. Moldovan soldiers participate periodically in multinational exercises, some on the territory of the Republic of Moldova, including the Bulboaca polygon, to which the author refers.In September, the combined multinational exercise was organized,  Fire shield/Rapid Trident - 2023 , the purpose being  to increase the interoperability between the participating contingents and the level of training for the peacekeeping operations , according to the Ministry of Defense in Chisinau. Although it is discussed in certain circles both in Chisinau and in Bucharest, about a potential union of the Republic of Moldova with Romania, this subject has never been officially put in discussions between the leaders of the political classes in the two states.Romania was, in fact, the first state to recognize the independence of the Republic of Moldova. Never European officials have given their turn on a possible union of the Republic of Moldova with Romania.The Republic of Moldova is considered in Brussels a sovereign and independent country, which in June 2022 obtained the status of state candidate for accession.The European Union is among the main international institutions that provide financial support to the Republic of Moldova, and Romania is among the leaders of the donor states. The criminal files that concerned some political leaders from Chisinau are often presented by Russian propaganda as a proof of the establishment of a Russian dictatorial regime in Chisinau.It is true that some opposition leaders have been detained in the last year.It is first of all about the former president, Igor Dodon, and the vice -president of the Sor party, Marina Tauber.Igor Dodon appears in several corruption files, but also a homeland betrayal, and Veridica has previously dismantled forgeries related to his files.And Marina Tauber also appears in several files related to the illegal financing of her formation.The SOR Party, a formation created and led by the fugitive ilan ilan Sor oligarch, convicted in the 2014 bank fraud file, which would be associated, with representatives of Russian secret services, was declared unconstitutional.Veridica has previously dismantled narratives related to this subject. And the establishment of censorship an intensely promoted accusation of Russian propaganda, argued in particular on a decision of the Commission Exceptional Situations of December 2022, which suspended the licenses of six television stations, accused of manipulation.In the last two years the Republic of Moldova has climbed with over 60 positions in terms of freedom of the press and has reached 28th in the world.Veridica has disassembled in a few rows narratives of Russian propaganda related to censorship in the Republic of Moldova", "debunking_argument": "The EU and Romania want Moldova to attach with the strength of Transnistria, and the Moldovan army simulates attacks on the region, writes the Russian press, which says the scenario in Nagorno Karabah will apply. News: the essence is that it is not fully clear how the opponents of Tiraspol see the future of Transnistria.There are different approaches in Chisinau.One of them claims that it must necessarily adhere to the European Union together with Transnistria, which must be subordinated to Chisina until the time of accession. The second, which the President of Moldova, Maia Sandu, and the head of diplomacy, Nicu Popescu, support that Moldova can adhere to the EU and without MRI, and the Transnistrians will come together.In Chisinau it is believed that accession is possible by 2030, and accession negotiations will start at the end of this year.However, it is unlikely that the EU will give up the enclave in which Moscow enjoys the sympathy of the population.Romania wants the entire territory of the former Moldovan RSS.Its calculation is simple: as a reward for its loyal services, it will be granted the mentioned territory.Thus, without getting involved in a direct conflict with Russia, Romania will obtain what it has held in 1941-1944.During this period, Romania held not only the territory of Moldova today, but also Odessa. By being aware of this, Chisinau began to threaten the inhabitants of Transnistria.Thus, the former Minister of Defense of Moldova (who is also a veteran of the pro-Roman movement in the late 1980s) Anatol Salaru publicly declared:  We must make our own destiny and make very harsh decisions regarding the reintegration of Transnistria.  [...] The establishment of a dictatorship is increasingly outlined.The broadcast of Russian programs in Moldova, especially news and political, has been completely interrupted.The real opposition, represented by the  Sor  party, was forbidden.Searches and arrests were carried out within the successor party  Renaissance . Two deputies from  Renaissance  were arrested.Most nationalist in the Moldovan Parliament forbade the activists of the party  SOR  to apply for elective functions for five years. Until the examination of this decision in Venice, its effects are suspended. [...] concerns that the EU and the US intend to obtain a significant advantage in the military field towards Transnistria.The situation, put in context with the Moldovan and Western military exercises on the Bulboaca polygon, located near the security area on the Dniester, in which the assaults are prepared - they form a complete image.Tiraspol believes that the solution is to strengthen the military cooperation between MRI and Russia. Narrations: 1. EU and Romania want to impose the forced annexation of Transnistria.2. The Moldovan army, with Western support, simulates attacks on Transnistria 3. Romania has territorial claims towards the Republic of Moldova, which also include the territory of Transnistria.4. In Chisinau, a nationalist regime was established that fight with the pro-Russian opposition. Context/Local Etos: Azerbaijan's army attacked the Armenian enclave Nagorno Karabah in September.Russia, who had peace forces in the region (and was also a traditional Armenia ally) did not intervene to protect the enclave, so it was quickly conquered, and in the following days its Armenian population took refuge, for fear ofpersecutions, in Armenia.The lack of reaction of Russia was explained on the one hand by the hostility to the current governance of Armenia, pro-democratic and interested in an approach to the West, and on the other by the lack of capacity of Russia to fulfill the obligations thatAnd he assumed them because of his involvement in the Ukraine war.Nagorno Karabah had, from an international point of view, a status similar to that of Transnistria - a separatist region not recognized at the international level.The West has never pleaded for the conflict regulation, did not collaborate with Azerbaijan when he attacked the Karabah and launched calls for cessing armed operations and protecting civilians - so the problem of a  model  Nagorno Karabah cannot be raised. Transnistria was attached to the former Soviet Moldovan Soviet Republic, founded after the USSR occupied and annexed the Romanian territories between Prut and Dniester, while the south of Bessarabia and Northern Bucovina were incorporated to the Ukrainian Soviet Republic, of which Transnistria had been part. With the dissemination of the USSR, Transnistria self-proclaimed their independence, and in 1992 it reached an armed conflict in which, along with the separatist forces, the XIV army of Russia was involved.On the territory of the separatist enclave there is currently a military warehouse with about 20,000 tons of ammunition, guarded by a Russian military contingent.The present ACEstuia is considered one of the main impediments in the regulation of the conflict.Russia has not fulfilled its international commitments to evacuate troops and ammunition. Starting with 2005, the negotiations for the regulation of the Transnistrian conflict are held in the so -called  5+2  format, attended by Russia, Ukraine and OSCE as negotiators, EU and USA - as observers, Chisinaul and Tiraspol - as involved parties.It took place with big breaks, and with the beginning of the war in Ukraine, the discussions stopped. In recent months, Russian propaganda has intensified a media campaign about alleged preparations of the Republic of Moldova with the support (or order) of the West and/or of Ukraine for an attack on the Transnistrian separatist region.The objective would be to open a second front against Russia - despite the fact that there is no terrestrial connection between Russia and Transnistria/Republic of Moldova, and the Russian forces present in the region are too small to represent a stake or a significant danger to Ukraine. Another narrative of the Russian propaganda and the one on the left of the Dniester is of an alleged intention of Romania to annex the territory of the Republic of Moldova, including the region on the left of the Dniester.The imminent union of the Republic of Moldova with Romania (the annexation of the Republic of Moldova) is one of the main  scarers  for part of the population, especially for ethnic minorities. This is associated with one of the oldest False Soviet anti-Roman narratives on  The Romanian gendarmerie  (which is mistreated, torture, was playing the local population), launched shortly after the Union of Bessarabia with Romania since 1918. Objective: to feed the foils of the population in Transnistria regarding an imminent annexation of its territory by Romania.To present the government in Chisinau as a nationalist and warmerist, which would prepare an armed attack on the secessionist region. Why the narratives are false: both the EU and the US, have always pleaded for the peaceful regulation of the conflict.Brussels was the one who first admitted, officially, this year the possibility of accessing the Republic of Moldova to the EU without the Transnistrian region, according to the model of Cyprus.This scenario was presented as a variant that can be taken into account by the High Representative of the European Union for Foreign Affairs and Security Policy, Josep Borrell, in the margin of the European Political Community, which took place in the Republic of Moldova on June 1..This is a proof of the fact that the EU does not insist that the Transnistrian region be brought under the control of Chisinau;The result is that Russia loses a key lever and can no longer block the European course of the Republic of Moldova, endlessly prolonging the frozen conflict in Transnistria.It should be noted, on the other hand, and that the EU does not try to attract the Republic of Moldova, but it wants to become a member of the EU. The assertion that Chisinau authorities would threaten the inhabitants of Transnistria is unfounded.The right-wing politician quoted in the article is not part of a political formation in government or with serious chances of reaching power. Chisinaul also rejected any attack scenario on the Transnistrian region and continues to identify a peaceful conflict regulation solution. Moldovan soldiers participate periodically in multinational exercises, some on the territory of the Republic of Moldova, including the Bulboaca polygon, to which the author refers.In September, the combined multinational exercise was organized,  Fire shield/Rapid Trident - 2023 , the purpose being  to increase the interoperability between the participating contingents and the level of training for the peacekeeping operations , according to the Ministry of Defense in Chisinau. Although it is discussed in certain circles both in Chisinau and in Bucharest, about a potential union of the Republic of Moldova with Romania, this subject has never been officially put in discussions between the leaders of the political classes in the two states.Romania was, in fact, the first state to recognize the independence of the Republic of Moldova. Never European officials have given their turn on a possible union of the Republic of Moldova with Romania.The Republic of Moldova is considered in Brussels a sovereign and independent country, which in June 2022 obtained the status of state candidate for accession.The European Union is among the main international institutions that provide financial support to the Republic of Moldova, and Romania is among the leaders of the donor states. The criminal files that concerned some political leaders from Chisinau are often presented by Russian propaganda as a proof of the establishment of a Russian dictatorial regime in Chisinau.It is true that some opposition leaders have been detained in the last year.It is primarily the former president, Igor Dodon, and the vice -president of the Sor party, MARina Tauber.Igor Dodon appears in several corruption files, but also a homeland betrayal, and Veridica has previously dismantled forgeries related to his files.And Marina Tauber also appears in several files related to the illegal financing of her formation.The SOR Party, a formation created and led by the fugitive ilan ilan Sor oligarch, convicted in the 2014 bank fraud file, which would be associated, with representatives of Russian secret services, was declared unconstitutional.Veridica has previously dismantled narratives related to this subject. And the establishment of censorship an intensely promoted accusation of Russian propaganda, argued in particular on a decision of the Commission Exceptional Situations of December 2022, which suspended the licenses of six television stations, accused of manipulation.In the last two years the Republic of Moldova has climbed with over 60 positions in terms of freedom of the press and has reached 28th in the world.Veridica has disassembled in a few rows narratives of Russian propaganda related to censorship in the Republic of Moldova"}
        '''
        master_parser = MasterParser()
        parsed = master_parser.parse(json_test)
        print(parsed['tags'])



if __name__ == '__main__':
    unittest.main()
